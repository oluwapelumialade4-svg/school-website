server.port=${PORT:8081}
server.error.include-message=always
server.error.include-stacktrace=always
server.error.whitelabel.enabled=true

# PostgreSQL Configuration (for production/cloud deployment)
spring.datasource.url=${SPRING_DATASOURCE_URL:${DATABASE_URL:jdbc:h2:mem:testdb;MODE=PostgreSQL}}
spring.datasource.username=${DB_USERNAME:sa}
spring.datasource.password=${DB_PASSWORD:}
# Disable ddl-auto in production when using Flyway migrations
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# Note: defer-datasource-initialization removed to fix Circular Dependency with Flyway
# Disable standard data.sql execution since we are using Flyway
spring.sql.init.mode=never

# Actuator configuration for health checks
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always

# Optimize for cloud deployment
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Connection pool settings for cloud
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000

# Flyway database migration configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=false
spring.flyway.locations=classpath:db/migration
spring.flyway.out-of-order=true
spring.flyway.connect-retries=3